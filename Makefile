.PHONY: container run test clean test-docker build tgz rpm
 
PROJECT=nomadesk-vault
BUILDDIR=build
CONFIGURATION=Release
VERSION:=$(shell cat VERSION)
REGISTRY:=registry.crazyzone.be

clean:
	rm -rf \
		rpmbuild \
		dist \
		src/*/bin/ \
		src/*/obj/ \
		TestResults \

build: clean
	dotnet restore ./src/Vault.sln
	dotnet publish -c $(CONFIGURATION) -o $(BUILDDIR) -r alpine-x64 --self-contained true -p:PublishTrimmed=true ./src/Vault/Vault.csproj

# Containers
container:
	docker build -t $(REGISTRY)/$(PROJECT):$(VERSION) . --network host

push: container
	docker push $(REGISTRY)/$(PROJECT):$(VERSION)
