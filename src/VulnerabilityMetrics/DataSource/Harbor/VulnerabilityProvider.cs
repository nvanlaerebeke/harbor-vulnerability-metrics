namespace VulnerabilityMetrics.DataSource.Harbor;

class VulnerabilityProvider
{
    private readonly HarborApi _harborApi;
    private readonly ProjectProvider _projectProvider;
    private readonly RepositoryProvider _repositoryProvider;

    private List<string> _projects = new();
    private List<string> _repositories = new();

    public VulnerabilityProvider(HarborApi harborApi)
    {
        _harborApi = harborApi;
        _projectProvider = new(_harborApi);
        _repositoryProvider = new(_harborApi);
    }
    
    public List<VulnerabilityReport> Get()
    {
        var newList = new List<VulnerabilityReport>();
        var projects = _projectProvider.Get();
        foreach (var project in projects)
        {
            var registries = _repositoryProvider.Get(project);
            foreach (var registry in registries)
            {
                
                newList.Add(new VulnerabilityReport
                {
                    Project = project,
                    Registry = registry,
                    Tag = null,
                    Critical = 0,
                    High = 0,
                    Medium = 0,
                    Low = 0
                });
            }
        }
        return newList;
    }
}