using VulnerabilityMetrics.DataSource.Harbor;

namespace VulnerabilityMetrics.DataSource;

internal class VulnerabilityDataProvider
{
    private const int Interval = 5;
    private List<VulnerabilityReport> _vulnerabilityReports = new();
    private readonly VulnerabilityProvider _vulnerabilityProvider;
    
    public VulnerabilityDataProvider(HarborApi harborApi)
    {
        _vulnerabilityProvider = new(harborApi);
    }
    
    public async Task Start()
    {
        await Task.Run(() =>
        {
            //ToDo: handle shutdown/cancellation
            while (true)
            {
                _vulnerabilityReports = _vulnerabilityProvider.Get();
                
                //Get the report every x seconds
                Task.Delay(Interval * 60);
            }
        });
    }
    
    public List<VulnerabilityReport> Get()
    {
        return new List<VulnerabilityReport>();
    }
}