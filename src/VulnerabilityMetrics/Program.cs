//Start fetching data from the harbor API

using VulnerabilityMetrics.DataSource;
using VulnerabilityMetrics.DataSource.Harbor;

//Data Provider
var vulnerabilityDataProvider = new VulnerabilityDataProvider(new HarborApi());
vulnerabilityDataProvider.Start().ConfigureAwait(false);

//Create the api application
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

app.MapGet("/metrics", () =>
{
    var reports = vulnerabilityDataProvider.Get();
    var metrics = string.Empty;
    foreach (var report in reports)
    {
        metrics += report.ToString();
    }
    return metrics;
});
app.MapGet("/", () => "Hello World");

//Start the application
app.Run();