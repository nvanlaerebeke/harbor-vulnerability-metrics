#build the source
FROM mcr.microsoft.com/dotnet/sdk:7.0-alpine as build-env
COPY . /source
RUN cd /source && \
    dotnet restore src/VulnerabilityMetrics.sln && \
    dotnet publish -c Release -o /build -r alpine-x64 --self-contained true -p:PublishTrimmed=true src/VulnerabilityMetrics/VulnerabilityMetrics.csproj

#application run container
FROM mcr.microsoft.com/dotnet/runtime-deps:7.0-alpine
ENV container docker
LABEL maintainer="Nico van Laerebeke <nico.vanlaerebeke@unifiedpost.com>"
EXPOSE 80

COPY --from=build-env /build /app
WORKDIR /app
ENTRYPOINT ["/app/VulnerabilityMetrics" ]
